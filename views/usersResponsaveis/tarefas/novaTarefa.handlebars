<div class="container-fluid pl-4 pr-4">

    <h2>Nova tarefa</h2>
    <h5 id="nomeObra">Obra {{obra.nome}}</h5>
    <div class="card mt-4">
        <div class="card-body">
            <label style="opacity: 0.5;">*Campos de preenchimento obrigatório</label>
            <form action="" name="getTarefa" method="POST">
                <input type="hidden" name="id" id="id" value="{{obra._id}}"> 
                <label for="nome">Nome*</label>
                <input type="text" id="nome" name="nome" value="{{nomeT}}"placeholder="Nome da tarefa" class="form-control mb-4" required>

                <label for="descricao">Descrição*</label>
                <textarea class="form-control mb-4" name="descricao" id="exampleFormControlTextarea1" rows="3" placeholder="Descrição da obra" required>{{descricao}}</textarea>

                <div class="form-group">
                    <label for="funcionarios">Funcionarios a associar*</label>
                    <select multiple class="form-control" id="funcionarios" name="funcionarios" required>
                        {{#each funcionarios}}
                            <option value="{{nome}}">{{nome}}</option>
                        {{/each}}
                    </select>
                </div>

                <label for="dataPrevistaInicio">Data prevista para inicio</label>
                <div class="row">
                    <div class="col-3">
                        <input type="datetime-local" value="{{data}}" name="dataPrevistaInicio" id="dataPrevistaInicio" class="form-control mb-4">
                    </div>
                </div>

                <div class="form-group">
                    <label for="importancia">Importância da tarefa</label>
                    <input type="hidden" id="importancia" value="{{tarefa.importancia}}">
                    <select class="form-control" id="importancia" name="importancia">
                        <option id="baixa">Baixa</option>
                        <option id="media">Média</option>
                        <option id="alta">Alta</option>
                    </select>
                </div>
                
                <div class="row justify-content-end">
                    <button type="submit" class="btn btn-success mt-3 mr-4"><i class="fa fa-check"></i> Concluir</button>
                    <button type="button" onclick="saltaParaObra()" class="btn btn-danger mt-3 mr-3"><i class="fa fa-close"></i> Cancelar</button>
                </div>
                </form>
        </div>
    </div>
</div>

<script>  
    window.onload = function() {
        var obra = document.getElementById('id').getAttribute("value");
        document.getTarefa.action = "/obra/"+obra+"/addTarefa";
    };  

    var imp = document.getElementById('importancia').getAttribute("value");
    if(imp == "baixa"){
        document.getElementById("baixa").setAttribute("selected", "selected")
    }else{
        if(imp == "media"){
            document.getElementById("media").setAttribute("selected", "selected")
        }
        else{
            if(imp == "alta"){    
                document.getElementById("alta").setAttribute("selected", "selected")
            }
        }
    }

    function saltaParaObra(){
        var obra = document.getElementById('id').getAttribute("value");
        window.location.href = "/obra/"+obra;
    }
</script>